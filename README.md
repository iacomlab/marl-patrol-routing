# Cooperative Patrol Routing: Optimizing Crime Surveillance through Multi-Agent Reinforcement Learning
Patrolling can be defined as the act of visiting locations of interest at regular intervals 
for either surveillance, control, protection, or monitoring purposes. To design effective patrolling
strategies, we propose a multi-agent reinforcement learning (MARL) model based on a decentralized 
partially observable Markov decision process. The route planning environment is formalized in an 
undirected graph where each patrolling agent has its own route, and cooperates with the others to 
avoid overlaps, and the routes should be unpredictable. The paper also delineates the manner in which 
this solution can be implemented to facilitate efficient police patrolling of medium-sized areas over 
the course of a single shift, with a particular focus on crime hotspots, in three real urban environments, 
corresponding to parts of the city of Málaga (Spain). From the street map, spatial action graphs of 
921, 923 and 1766 nodes has been automatically generated, where each node represents an area of 
50m x 50 m and the vertices indicate the connectivity on foot or by vehicle between the nodes. 
Several MARL algorithms have been tested, but efforts have focused on VDPPO, 
while a representative set of values has been tested for the number of patrols 
and their line-of-sight range in the city of Málaga, we have designed a crime 
coverage metric inspired in the predictive accuracy index (PAI), 
which is commonly used in criminology for detecting hotspots. 
The coordinated route generated by our model achieved a coverage of more 
than 90% of the 3% of graph nodes with the highest crime incidence, 
and 65% for 20% of those nodes; 3% and 20% represent the standards of coverage 
for police resource allocation.

## Citation

## Instalation

The code was implemented in Python 3.9. And all the dependencies are specified in the requirements.txt. The code was executed via cpu in windows and via gpu in ubuntu.

## Data

All the data is stored in MongoDB while the configurations and the parameters of the algorithms are in yaml format. Unfortunately, we cannot make the mongodata used publicly available due to confidentiality concerns, as they involve police-related information.

The only information we can publish is the format of the data.

### Data format
The data was stored in a collection named cuadrado_octates_resumido, the format is the following.

- v5: object (internal_position inside the grid, corner left top is 0,0; it is used as an identifier for the cell)
  - lat: int 
  - lon: int
- zona_algoritmo: str (identifier of the zone)
- transitable: bool (is the cell walkable or not)
- cuadricula: object (dimension of the grid)
  - numero_celdas_anchura: int (number of cell for the base of the grid (witdh))
  - numero_celdas_altura: int (number of cell for the side of the grid (height))
  - lat_min: float (real value of minimal latitude inside the grid)
  - lat_max: float (real value of maximum latitude inside the grid)
  - lon_min: float (real value of minimal longitude inside the grid)
  - lon_max: float (real value of maximum longitude inside the grid)
- vecinos: array[] (Identifiers of the neightbours cells (v5))
- vecinos_vias: array[] (Identifiers of the neightbours cells which has a common street (v5))
- vias: array[tuples]
  - Identifier
  - Type of street
  - Name of the street
- vias_ampliadas: dict -> identifier_street: object
  - cuadrados_total: int (Number of cell in which this cell is located)
  - puntos_cuadrado: int (Number of points of the polygon of the street which are in this cell)
  - puntos_total: int (Number of points of the polygon of the street)
  - delitos: list[dict] (Crimes in that street) -> typology_crimes: number of crimes

BSON example:

```` 
{
  _id: ObjectId("6486e911b0393b22d697f4e0"),
  v5: { lat: 124, lon: 253 },
  zona_algoritmo: '3',
  transitable: true,
  cuadricula: {
    extension_lat: 0.1456139999999948,
    extension_lon: 0.2870119999999998,
    lat_celda: 0.0004494259259259099,
    lon_celda: 0.0005562248062015501,
    numero_celdas_anchura: 516,
    numero_celdas_altura: 324,
    lat_min: 36.644322,
    lat_max: 36.789936,
    lon_min: -4.576464,
    lon_max: -4.289452
  },
  vecinos: [
      [ 125, 252 ],
      [ 125, 254 ],
      [ 125, 253 ],
      [ 123, 252 ],
      [ 123, 254 ],
      [ 123, 253 ],
      [ 124, 252 ],
      [ 124, 254 ]
    ],
  vecinos_vias: [
    [ 124, 252 ],
    [ 125, 254 ],
    [ 123, 254 ],
    [ 124, 254 ],
    [ 125, 253 ],
    [ 125, 252 ],
    [ 123, 253 ],
    [ 123, 252 ]
  ],
  vias: [
    [ 18197, 'GTA', 'ANTONIO MOLINA' ],
    [ 16637, 'PSO', 'ANTONIO MACHADO' ],
    [ '192417278', null, null ],
    [ '192552380', null, null ],
    [ '192552409', null, null ],
    [ '192552410', null, null ],
    [ '192552411', null, null ],
    [ '192552424', null, null ],
    [ '192552430', null, null ],
    [ '762650557', null, null ]
  ],
  vias_ampliadas: {
    '16637': {
      puntos_cuadrado: 2,
      cuadrados_total: 107,
      puntos_total: 313,
      delitos: [
        {
          'A': 554,
          'B': 294
        }
      ]
    },
    '18197': {
      puntos_cuadrado: 1,
      cuadrados_total: 4,
      puntos_total: 7,
      delitos: [
        {
          'A': 6,
          'B': 5
        }
      ]
    },
    '192417278': {
      puntos_cuadrado: 3,
      cuadrados_total: 91,
      puntos_total: 478,
      delitos: []
    },
    '192552380': {
      puntos_cuadrado: 3,
      cuadrados_total: 3,
      puntos_total: 18,
      delitos: []
    },
    '192552409': {
      puntos_cuadrado: 3,
      cuadrados_total: 1,
      puntos_total: 3,
      delitos: []
    },
    '192552410': {
      puntos_cuadrado: 3,
      cuadrados_total: 1,
      puntos_total: 3,
      delitos: []
    },
    '192552411': {
      puntos_cuadrado: 3,
      cuadrados_total: 5,
      puntos_total: 10,
      delitos: []
    },
    '192552424': {
      puntos_cuadrado: 3,
      cuadrados_total: 6,
      puntos_total: 39,
      delitos: []
    },
    '192552430': {
      puntos_cuadrado: 3,
      cuadrados_total: 1,
      puntos_total: 3,
      delitos: []
    },
    '762650557': {
      puntos_cuadrado: 3,
      cuadrados_total: 2,
      puntos_total: 6,
      delitos: []
    }
  }
}
````

